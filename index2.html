<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PulseX Token Pair Price</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
</head>
<body>
  <h1>PulseX Token Pair Price</h1>
  <p>Token0 Address: <span id="token0"></span></p>
  <p>Token1 Address: <span id="token1"></span></p>
  <p>Reserve0 (Token0): <span id="reserve0"></span></p>
  <p>Reserve1 (Token1): <span id="reserve1"></span></p>
  <p>Price of Token0 in terms of Token1: <span id="priceToken0"></span></p>
  <p>Price of Token1 in terms of Token0: <span id="priceToken1"></span></p>
  <button id="fetchPrice">Fetch Prices</button>

  <script>
    const RPC_URL = "https://pulsechain-rpc.publicnode.com";
    const PAIR_ADDRESS = "0x901da5d07Ea7Ee8B17A61fca83076D3B4D4F7929";
    const ERC20_ABI = [
      "function decimals() view returns (uint8)"
    ];
    const PAIR_ABI = [
      "function getReserves() external view returns (uint112 reserve0, uint112 reserve1, uint32 blockTimestampLast)",
      "function token0() external view returns (address)",
      "function token1() external view returns (address)"
    ];

    document.getElementById('fetchPrice').addEventListener('click', async () => {
      try {
        const provider = new ethers.providers.JsonRpcProvider(RPC_URL);
        const pairContract = new ethers.Contract(PAIR_ADDRESS, PAIR_ABI, provider);

        // Fetch token addresses
        const token0 = await pairContract.token0();
        const token1 = await pairContract.token1();
        document.getElementById('token0').textContent = token0;
        document.getElementById('token1').textContent = token1;

        // Fetch reserves
        const reserves = await pairContract.getReserves();
        const reserve0 = ethers.BigNumber.from(reserves[0]);
        const reserve1 = ethers.BigNumber.from(reserves[1]);
        document.getElementById('reserve0').textContent = reserve0.toString();
        document.getElementById('reserve1').textContent = reserve1.toString();

        // Fetch decimals for each token
        const token0Contract = new ethers.Contract(token0, ERC20_ABI, provider);
        const token1Contract = new ethers.Contract(token1, ERC20_ABI, provider);
        const decimals0 = await token0Contract.decimals();
        const decimals1 = await token1Contract.decimals();

        // Adjust reserves based on decimals
        const adjustedReserve0 = reserve0.mul(ethers.BigNumber.from(10).pow(18 - decimals0));
        const adjustedReserve1 = reserve1.mul(ethers.BigNumber.from(10).pow(18 - decimals1));

        // Calculate prices
        const priceToken0 = adjustedReserve1.div(adjustedReserve0).toString(); // Token0 price in terms of Token1
        const priceToken1 = adjustedReserve0.div(adjustedReserve1).toString(); // Token1 price in terms of Token0

        // Display prices
        document.getElementById('priceToken0').textContent = parseFloat(priceToken0).toFixed(6);
        document.getElementById('priceToken1').textContent = parseFloat(priceToken1).toFixed(6);
      } catch (error) {
        console.error("Error fetching data:", error);
        alert("An error occurred while fetching prices. Check the console for details.");
      }
    });
  </script>
</body>
</html>
