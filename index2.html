<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLSX/DAI Price Feed</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.0/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>PLSX/DAI Price Feed</h1>
    <p id="price"></p>
    <button onclick="checkPrice()">Get PLSX Price</button>

    <script>
        // Replace with your PulseChain RPC endpoint
        const provider = new ethers.JsonRpcProvider('https://pulsechain-rpc.publicnode.com');

        // PLSX/DAI Pair Contract Address on PulseX
        const pairAddress = '0xB2893ceA8080bF43b7b60B589EDaAb5211D98F23';

        // ERC-20 ABI (used to interact with the pair contract)
        const erc20Abi = [
            "function getReserves() external view returns (uint112, uint112, uint32)",
            "function decimals() external view returns (uint8)"
        ];

        // Function to fetch reserves for PLSX/DAI pair
        async function getReserves() {
            const pairContract = new ethers.Contract(pairAddress, erc20Abi, provider);
            const reserves = await pairContract.getReserves();
            return reserves;
        }

        // Function to calculate price of PLSX in terms of DAI
        async function calculatePrice() {
            try {
                const reserves = await getReserves();
                const reservePLSX = reserves[0];  // Reserve for PLSX
                const reserveDAI = reserves[1];   // Reserve for DAI (stablecoin)
                
                // DAI is 1:1 with USD, so its price is $1
                const pricePLSX = reserveDAI / reservePLSX;  // Price of PLSX in terms of DAI
                return pricePLSX;
            } catch (error) {
                console.error('Error fetching reserves:', error);
                return null;
            }
        }

        // Function to check price and trigger events
        async function checkPrice() {
            try {
                const price = await calculatePrice();
                if (price !== null) {
                    document.getElementById('price').innerText = `PLSX Price (in DAI): ${price.toFixed(6)}`;
                    
                    // Trigger sell event if price reaches target (example: sell if price > 1.5)
                    const targetPrice = 1.5; // Example target price in DAI
                    if (price > targetPrice) {
                        alert('Target price reached! Triggering sell event.');
                        // You can add your sell event logic here
                    }
                } else {
                    document.getElementById('price').innerText = 'Error fetching price.';
                }
            } catch (error) {
                console.error('Error checking price:', error);
            }
        }
    </script>
</body>
</html>
