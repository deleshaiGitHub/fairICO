<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connect Solana Wallet</title>
  <!-- Correct CDN Link -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@1.76.0/dist/web3.min.js"></script>
</head>
<body>
  <h1>Welcome to Solana App</h1>
  <button id="connect-button">Connect Wallet</button>
  <div id="user-info"></div>

  <script>
    const { Connection, PublicKey, clusterApiUrl, LAMPORTS_PER_SOL } = solanaWeb3;

    // Replace with your dedicated RPC endpoint
    const MAINNET_RPC_URL = 'https://your-quicknode-or-custom-rpc-url.com';

    const connection = new Connection(MAINNET_RPC_URL);

    const userInfoDiv = document.getElementById('user-info');
    const connectButton = document.getElementById('connect-button');

    const fetchBalance = async (publicKey) => {
      try {
        // Fetch the SOL balance
        const balance = await connection.getBalance(new PublicKey(publicKey));
        const solBalance = balance / LAMPORTS_PER_SOL; // Convert lamports to SOL
        console.log("SOL Balance:", solBalance);

        if (solBalance === 0) {
          userInfoDiv.innerHTML += `<p>Your SOL balance is zero. Please fund your wallet.</p>`;
        } else {
          userInfoDiv.innerHTML += `<p>SOL Balance: <strong>${solBalance.toFixed(4)} SOL</strong></p>`;
        }
      } catch (error) {
        console.error("Failed to fetch balance:", error);
        if (error.message.includes("403")) {
          userInfoDiv.innerHTML += `<p>Access forbidden: Please check your RPC URL or try again later.</p>`;
        } else {
          userInfoDiv.innerHTML += "<p>Failed to fetch balance. Please try again.</p>";
        }
      }
    };

    const connectWallet = async () => {
      if (!window.solana || !window.solana.isPhantom) {
        alert("Please install the Phantom wallet extension.");
        return;
      }

      try {
        const response = await window.solana.connect();
        console.log("Connected wallet:", response.publicKey.toString());

        userInfoDiv.innerHTML = `<p>Wallet Address: <strong>${response.publicKey.toString()}</strong></p>`;

        // Fetch and display SOL balance
        await fetchBalance(response.publicKey.toString());
      } catch (error) {
        console.error("Failed to connect wallet:", error);
        userInfoDiv.innerHTML = "<p>Failed to connect wallet. Please try again.</p>";
      }
    };

    connectButton.addEventListener('click', connectWallet);
  </script>
</body>
</html>
