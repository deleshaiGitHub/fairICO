// Frontend for Staking Contract

import React, { useState, useEffect } from 'react';
import { ethers } from 'ethers';

// Replace these with your actual contract addresses and ABIs
const TOKEN_ADDRESS = 'YOUR_TOKEN_ADDRESS';
const STAKING_ADDRESS = 'YOUR_STAKING_CONTRACT_ADDRESS';
const TOKEN_ABI = [/* Paste your token ABI here */];
const STAKING_ABI = [/* Paste your staking contract ABI here */];

const App = () => {<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staking DApp</title>
  <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
  <h1>Staking DApp</h1>
  <button id="connectButton">Connect Wallet</button>
  <p id="walletAddress">Wallet: Not connected</p>
  <hr>

  <h2>Approve Tokens</h2>
  <label for="approveAmount">Amount to Approve (STC):</label>
  <input type="number" id="approveAmount" placeholder="Enter amount">
  <button id="approveButton">Approve</button>
  <hr>

  <h2>Stake Tokens</h2>
  <label for="stakeAmount">Amount to Stake (STC):</label>
  <input type="number" id="stakeAmount" placeholder="Enter amount"><br>
  <label for="stakeDuration">Lock Duration (seconds):</label>
  <input type="number" id="stakeDuration" placeholder="Enter lock duration"><br>
  <button id="stakeButton">Stake</button>

  <script>
    const STC_TOKEN_ADDRESS = "0x7D1F668D0CDb20127cF9ed657DC634c7c6b2c967"; // Replace with your token address
    const STAKING_CONTRACT_ADDRESS = "0xc67314c605A1A9F437a36f451B2C35e5A956562F"; // Replace with your staking contract address
    const STC_ABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "approve",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "allowance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "needed",
				"type": "uint256"
			}
		],
		"name": "ERC20InsufficientAllowance",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "balance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "needed",
				"type": "uint256"
			}
		],
		"name": "ERC20InsufficientBalance",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "approver",
				"type": "address"
			}
		],
		"name": "ERC20InvalidApprover",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "receiver",
				"type": "address"
			}
		],
		"name": "ERC20InvalidReceiver",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "sender",
				"type": "address"
			}
		],
		"name": "ERC20InvalidSender",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			}
		],
		"name": "ERC20InvalidSpender",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			}
		],
		"name": "OwnableInvalidOwner",
		"type": "error"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "OwnableUnauthorizedAccount",
		"type": "error"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "spender",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "Approval",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "previousOwner",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "OwnershipTransferred",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "renounceOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "transfer",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"indexed": true,
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "Transfer",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "from",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "to",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "value",
				"type": "uint256"
			}
		],
		"name": "transferFrom",
		"outputs": [
			{
				"internalType": "bool",
				"name": "",
				"type": "bool"
			}
		],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "newOwner",
				"type": "address"
			}
		],
		"name": "transferOwnership",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "owner",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "spender",
				"type": "address"
			}
		],
		"name": "allowance",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "account",
				"type": "address"
			}
		],
		"name": "balanceOf",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "decimals",
		"outputs": [
			{
				"internalType": "uint8",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "name",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "symbol",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalSupply",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];
    const STAKING_ABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_stakingToken",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_rewardToken",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_deployer",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "RewardDistributed",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "lockingPeriodInSeconds",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "rewardPoints",
				"type": "uint256"
			}
		],
		"name": "StakeLocked",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "lockingPeriodInSeconds",
				"type": "uint256"
			}
		],
		"name": "StakeUnlocked",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint72",
				"name": "tokenAmount",
				"type": "uint72"
			},
			{
				"internalType": "uint32",
				"name": "lockingPeriodInSeconds",
				"type": "uint32"
			}
		],
		"name": "calculateStakingRewardPoints",
		"outputs": [
			{
				"internalType": "uint128",
				"name": "",
				"type": "uint128"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "deployer",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "distributeRewards",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint72",
				"name": "tokenAmount",
				"type": "uint72"
			},
			{
				"internalType": "uint32",
				"name": "lockingPeriodInSeconds",
				"type": "uint32"
			}
		],
		"name": "lockTokens",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minStakingTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "rewardPointsEarned",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "rewardToken",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "stakes",
		"outputs": [
			{
				"internalType": "uint72",
				"name": "tokenAmount",
				"type": "uint72"
			},
			{
				"internalType": "uint32",
				"name": "startTime",
				"type": "uint32"
			},
			{
				"internalType": "uint32",
				"name": "lockingPeriodInSeconds",
				"type": "uint32"
			},
			{
				"internalType": "uint128",
				"name": "expectedStakingRewardPoints",
				"type": "uint128"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "stakingToken",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalRewardPoints",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "unlockTokens",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];

    let web3;
    let userAddress;
    let stcToken;
    let stakingContract;

    // Connect wallet
    document.getElementById('connectButton').addEventListener('click', async () => {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        userAddress = (await web3.eth.getAccounts())[0];
        document.getElementById('walletAddress').textContent = `Wallet: ${userAddress}`;
        stcToken = new web3.eth.Contract(STC_ABI, STC_TOKEN_ADDRESS);
        stakingContract = new web3.eth.Contract(STAKING_ABI, STAKING_CONTRACT_ADDRESS);
      } else {
        alert('MetaMask is not installed. Please install it to use this DApp.');
      }
    });

    // Approve tokens
    document.getElementById('approveButton').addEventListener('click', async () => {
      const amount = document.getElementById('approveAmount').value;
      if (amount > 0 && userAddress) {
        try {
          const decimals = await stcToken.methods.decimals().call();
          const amountInWei = web3.utils.toWei(amount, 'ether');
          await stcToken.methods.approve(STAKING_CONTRACT_ADDRESS, amountInWei).send({ from: userAddress });
          alert('Approval successful!');
        } catch (error) {
          console.error(error);
          alert('Approval failed!');
        }
      } else {
        alert('Enter a valid amount or connect your wallet.');
      }
    });

    // Stake tokens
    document.getElementById('stakeButton').addEventListener('click', async () => {
      const amount = document.getElementById('stakeAmount').value;
      const duration = document.getElementById('stakeDuration').value;
      if (amount > 0 && duration > 0 && userAddress) {
        try {
          const decimals = await stcToken.methods.decimals().call();
          const amountInWei = web3.utils.toWei(amount, 'ether');
          await stakingContract.methods.stake(amountInWei, duration).send({ from: userAddress });
          alert('Staking successful!');
        } catch (error) {
          console.error(error);
          alert('Staking failed!');
        }
      } else {
        alert('Enter valid amounts or connect your wallet.');
      }
    });
  </script>
</body>
</html>

    const [provider, setProvider] = useState(null);
    const [signer, setSigner] = useState(null);
    const [address, setAddress] = useState('');
    const [tokenBalance, setTokenBalance] = useState('0');
    const [allowance, setAllowance] = useState('0');
    const [stakeAmount, setStakeAmount] = useState('');
    const [lockDuration, setLockDuration] = useState('');

    useEffect(() => {
        if (window.ethereum) {
            const initProvider = new ethers.providers.Web3Provider(window.ethereum);
            setProvider(initProvider);
        } else {
            alert('Please install MetaMask to use this application.');
        }
    }, []);

    const connectWallet = async () => {
        try {
            await provider.send('eth_requestAccounts', []);
            const signerInstance = provider.getSigner();
            setSigner(signerInstance);

            const userAddress = await signerInstance.getAddress();
            setAddress(userAddress);

            await fetchBalancesAndAllowance(userAddress);
        } catch (error) {
            console.error('Error connecting wallet:', error);
        }
    };

    const fetchBalancesAndAllowance = async (userAddress) => {
        try {
            const tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, provider);
            const stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, provider);

            const balance = await tokenContract.balanceOf(userAddress);
            const userAllowance = await tokenContract.allowance(userAddress, STAKING_ADDRESS);

            setTokenBalance(ethers.utils.formatUnits(balance, 18));
            setAllowance(ethers.utils.formatUnits(userAllowance, 18));
        } catch (error) {
            console.error('Error fetching balances and allowance:', error);
        }
    };

    const approveTokens = async () => {
        try {
            const tokenContract = new ethers.Contract(TOKEN_ADDRESS, TOKEN_ABI, signer);
            const tx = await tokenContract.approve(STAKING_ADDRESS, ethers.utils.parseUnits('1000000', 18)); // Approve a large amount
            await tx.wait();
            alert('Approval successful!');
            await fetchBalancesAndAllowance(address);
        } catch (error) {
            console.error('Error approving tokens:', error);
        }
    };

    const stakeTokens = async () => {
        try {
            const stakingContract = new ethers.Contract(STAKING_ADDRESS, STAKING_ABI, signer);
            const tx = await stakingContract.stake(
                ethers.utils.parseUnits(stakeAmount, 18),
                lockDuration
            );
            await tx.wait();
            alert('Tokens staked successfully!');
            setStakeAmount('');
            setLockDuration('');
            await fetchBalancesAndAllowance(address);
        } catch (error) {
            console.error('Error staking tokens:', error);
        }
    };

    return (
        <div style={{ padding: '20px', fontFamily: 'Arial' }}>
            <h1>Staking DApp</h1>
            {!address ? (
                <button onClick={connectWallet}>Connect Wallet</button>
            ) : (
                <div>
                    <p>Connected Wallet: {address}</p>
                    <p>Token Balance: {tokenBalance}</p>
                    <p>Allowance: {allowance}</p>

                    <div>
                        <h3>Approve Tokens</h3>
                        <button onClick={approveTokens}>Approve</button>
                    </div>

                    <div>
                        <h3>Stake Tokens</h3>
                        <input
                            type="number"
                            placeholder="Amount to Stake"
                            value={stakeAmount}
                            onChange={(e) => setStakeAmount(e.target.value)}
                        />
                        <input
                            type="number"
                            placeholder="Lock Duration (seconds)"
                            value={lockDuration}
                            onChange={(e) => setLockDuration(e.target.value)}
                        />
                        <button onClick={stakeTokens}>Stake</button>
                    </div>
                </div>
            )}
        </div>
    );
};

export default App;
