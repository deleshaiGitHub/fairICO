<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staking DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/web3/dist/web3.min.js"></script>
</head>
<body>
    <h2>Staking DApp</h2>
    <div>
        <label for="tokenAmount">Amount to Stake (in tokens):</label>
        <input type="number" id="tokenAmount" placeholder="Enter amount" required>
    </div>
    <div>
        <label for="lockingPeriod">Locking Period (in seconds):</label>
        <input type="number" id="lockingPeriod" placeholder="Enter locking period" required>
    </div>
    <button onclick="approveAndStake()">Stake</button>

    <p id="transactionStatus"></p>

   <script>
    // Define Web3 and Contract ABI
    const web3 = new Web3(window.ethereum);
    const stakingContractAddress = '0xc67314c605A1A9F437a36f451B2C35e5A956562F'; // Your deployed staking contract address
    const stakingContractABI = [
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_stakingToken",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_rewardToken",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_deployer",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "RewardDistributed",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "lockingPeriodInSeconds",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "rewardPoints",
				"type": "uint256"
			}
		],
		"name": "StakeLocked",
		"type": "event"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "tokenAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "lockingPeriodInSeconds",
				"type": "uint256"
			}
		],
		"name": "StakeUnlocked",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint72",
				"name": "tokenAmount",
				"type": "uint72"
			},
			{
				"internalType": "uint32",
				"name": "lockingPeriodInSeconds",
				"type": "uint32"
			}
		],
		"name": "calculateStakingRewardPoints",
		"outputs": [
			{
				"internalType": "uint128",
				"name": "",
				"type": "uint128"
			}
		],
		"stateMutability": "pure",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "deployer",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "recipient",
				"type": "address"
			},
			{
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			}
		],
		"name": "distributeRewards",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint72",
				"name": "tokenAmount",
				"type": "uint72"
			},
			{
				"internalType": "uint32",
				"name": "lockingPeriodInSeconds",
				"type": "uint32"
			}
		],
		"name": "lockTokens",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "minStakingTime",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "rewardPointsEarned",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "rewardToken",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "stakes",
		"outputs": [
			{
				"internalType": "uint72",
				"name": "tokenAmount",
				"type": "uint72"
			},
			{
				"internalType": "uint32",
				"name": "startTime",
				"type": "uint32"
			},
			{
				"internalType": "uint32",
				"name": "lockingPeriodInSeconds",
				"type": "uint32"
			},
			{
				"internalType": "uint128",
				"name": "expectedStakingRewardPoints",
				"type": "uint128"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "stakingToken",
		"outputs": [
			{
				"internalType": "contract IERC20",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "totalRewardPoints",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "",
				"type": "uint256"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "unlockTokens",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
];

    const stakingContract = new web3.eth.Contract(stakingContractABI, stakingContractAddress);

    // Token addresses
    const stakingTokenAddress = '0x7D1F668D0CDb20127cF9ed657DC634c7c6b2c967'; // Your token contract address
    const rewardTokenAddress = '0x7D1F668D0CDb20127cF9ed657DC634c7c6b2c967'; // Your reward token contract address

    async function approveAndStake() {
        let amount = document.getElementById('tokenAmount').value;
        let duration = document.getElementById('lockingPeriod').value;

        if (!amount || !duration) {
            alert('Please enter both amount and duration.');
            return;
        }

        try {
            // Approve tokens for staking
            let approvalTx = await stakingContract.methods.approve(stakingTokenAddress, web3.utils.toWei(amount, 'ether')).send({
                from: web3.eth.defaultAccount,
                gas: 300000
            });

            // Estimate gas for lockTokens
            let estimatedGas = await stakingContract.methods.lockTokens(
                web3.utils.toWei(amount, 'ether'), 
                duration
            ).estimateGas({ from: web3.eth.defaultAccount });

            // Call the staking contract
            let stakingTx = await stakingContract.methods.lockTokens(
                web3.utils.toWei(amount, 'ether'), 
                duration
            ).send({
                from: web3.eth.defaultAccount,
                gas: estimatedGas
            });

            document.getElementById('transactionStatus').innerText = `Staking successful! Transaction: ${stakingTx.transactionHash}`;
        } catch (error) {
            console.error('Error:', error);
            document.getElementById('transactionStatus').innerText = 'An error occurred during staking.';
        }
    }
</script>

</body>
</html>
