<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCABot Interface</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
    <h1>DCABot User Interface</h1>

    <section id="deposit">
        <h2>Deposit</h2>
        <label for="daiAmount">DAI Amount:</label>
        <input type="number" id="daiAmount" placeholder="DAI Amount">
        <label for="plsAmount">PLS Amount:</label>
        <input type="number" id="plsAmount" placeholder="PLS Amount">
        <button onclick="deposit()">Deposit</button>
    </section>

    <section id="dca">
        <h2>DCA Configuration</h2>
        <button onclick="initializeDCA()">Initialize DCA</button>
        <button onclick="executeDCA()">Execute DCA</button>
        <button onclick="stopDCA()">Stop DCA</button>
    </section>

    <section id="withdraw">
        <h2>Withdraw</h2>
        <button onclick="withdraw()">Withdraw</button>
    </section>

    <div id="status"></div>

    <script>
    let contract;
    let dai;
    let pls;

    async function getAccounts() {
        return await web3.eth.getAccounts();
    }

    async function deposit() {
        const accounts = await getAccounts();
        const daiAmount = document.getElementById('daiAmount').value;
        const plsAmount = document.getElementById('plsAmount').value;

        // ABI for ERC20 tokens (DAI and PLS in this case)
        const erc20ABI = [
            {
                "constant": false,
                "inputs": [
                    {"name": "spender", "type": "address"},
                    {"name": "amount", "type": "uint256"}
                ],
                "name": "approve",
                "outputs": [{"name": "", "type": "bool"}],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        // Assuming you know the addresses for DAI and PLS
        const daiAddress = "0x6B175474E89094C44Da98b954EedeAC495271d0F"; // Replace with actual DAI contract address
        const plsAddress = "0xA1077a294dDE1B09bB078844df40758a5D0f9a27"; // Replace with actual PLS contract address

        // Initialize token contracts
        dai = new web3.eth.Contract(erc20ABI, daiAddress);
        pls = new web3.eth.Contract(erc20ABI, plsAddress);

        try {
            // Approve DAI
            await dai.methods.approve(contract.options.address, daiAmount).send({ from: accounts[0] });
            // Approve PLS
            await pls.methods.approve(contract.options.address, plsAmount).send({ from: accounts[0] });

            // After approval, attempt deposit
            await contract.methods.deposit(daiAmount, plsAmount).send({ from: accounts[0], gas: 60000 });
            document.getElementById('status').innerText = "Deposit successful!";
        } catch (error) {
            console.error('Deposit error:', error);
            document.getElementById('status').innerText = "Deposit failed: " + error.message;
        }
    }

    // ... Other functions here ...

    window.addEventListener('load', async () => {
        if (window.ethereum) {
            try {
                await window.ethereum.request({ method: 'eth_requestAccounts' });
                window.web3 = new Web3(window.ethereum);
            } catch (error) {
                console.error("User denied account access");
            }
        } else {
            console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
            // Fallback to local node or another provider if needed
        }

            // ABI of your DCABot contract
            const contractABI = [
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "daiAmount",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "plsAmount",
				"type": "uint256"
			}
		],
		"name": "deposit",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "executeDCA",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "_oracleAddress",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_teddyAddress",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_daiAddress",
				"type": "address"
			},
			{
				"internalType": "address",
				"name": "_plsAddress",
				"type": "address"
			}
		],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "daiAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "plsAmount",
				"type": "uint256"
			}
		],
		"name": "Deposit",
		"type": "event"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "baseOrderSize",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrderSize",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "priceDeviation",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "maxSafetyOrders",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrderVolumeScale",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrderStepScale",
				"type": "uint256"
			}
		],
		"name": "initializeDCA",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "amount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "price",
				"type": "uint256"
			}
		],
		"name": "OrderExecuted",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "stopDCA",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "withdraw",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": true,
				"internalType": "address",
				"name": "user",
				"type": "address"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "daiAmount",
				"type": "uint256"
			},
			{
				"indexed": false,
				"internalType": "uint256",
				"name": "plsAmount",
				"type": "uint256"
			}
		],
		"name": "Withdraw",
		"type": "event"
	},
	{
		"inputs": [],
		"name": "daiAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "oracleAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "owner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "plsAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "teddyAddress",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"name": "userConfigs",
		"outputs": [
			{
				"internalType": "uint256",
				"name": "baseOrderSize",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrderSize",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "priceDeviation",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "maxSafetyOrders",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrderVolumeScale",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrderStepScale",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "daiBalance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "plsBalance",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "initialPrice",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "safetyOrdersPlaced",
				"type": "uint256"
			},
			{
				"internalType": "bool",
				"name": "active",
				"type": "bool"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
];

            const contractAddress = "0x303CDf9a4E9730d281162e086E2F21C2b3Ab6b7d"; 

            contract = new web3.eth.Contract(contractABI, contractAddress);  // Define contract here
        });
    </script>
</body>
</html>
