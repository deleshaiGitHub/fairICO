<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCA Bot UI</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
</head>
<body>
    <h1>DCA Bot Interface</h1>

    <!-- Deposit Section -->
    <h2>Deposit</h2>
    <label for="daiAmount">DAI Amount: </label>
    <input type="number" id="daiAmount" placeholder="DAI Amount">
    <br>
    <label for="plsAmount">PLS Amount: </label>
    <input type="number" id="plsAmount" placeholder="PLS Amount">
    <br>
    <button onclick="deposit()">Deposit</button>

    <!-- Withdraw Section -->
    <h2>Withdraw</h2>
    <button onclick="withdraw()">Withdraw</button>

    <!-- Initialize DCA Section -->
    <h2>Initialize DCA</h2>
    <label for="baseOrderSize">Base Order Size: </label>
    <input type="number" id="baseOrderSize">
    <br>
    <label for="safetyOrderSize">Safety Order Size: </label>
    <input type="number" id="safetyOrderSize">
    <br>
    <label for="priceDeviation">Price Deviation (%): </label>
    <input type="number" id="priceDeviation">
    <br>
    <label for="maxSafetyOrders">Max Safety Orders: </label>
    <input type="number" id="maxSafetyOrders">
    <br>
    <label for="safetyOrderVolumeScale">Safety Order Volume Scale: </label>
    <input type="number" id="safetyOrderVolumeScale">
    <br>
    <label for="safetyOrderStepScale">Safety Order Step Scale: </label>
    <input type="number" id="safetyOrderStepScale">
    <br>
    <button onclick="initializeDCA()">Initialize DCA</button>

    <!-- Execute DCA Section -->
    <h2>Execute DCA</h2>
    <button onclick="executeDCA()">Execute DCA</button>

    <!-- Stop DCA Section -->
    <h2>Stop DCA</h2>
    <button onclick="stopDCA()">Stop DCA</button>

    <script>
        // Web3 setup
        const web3 = new Web3(window.ethereum);
        let userAccount;

        window.ethereum.request({ method: 'eth_requestAccounts' })
            .then(accounts => {
                userAccount = accounts[0];
                console.log('Connected to account:', userAccount);
            })
            .catch(error => {
                console.error('User denied account access', error);
                alert('Please connect to MetaMask');
            });

        // Contract Addresses
        const DAI_CONTRACT_ADDRESS = "0x6B175474E89094C44Da98b954EedeAC495271d0F";  // DAI contract address
        const PLS_CONTRACT_ADDRESS = "0xA1077a294dDE1B09bB078844df40758a5D0f9a27";  // PLS contract address
        const CONTRACT_ADDRESS = "0x303CDf9a4E9730d281162e086E2F21C2b3Ab6b7d";  // DCA contract address

        // ABI for interacting with the DCA contract
        const DCA_ABI = [
            {
                "constant": false,
                "inputs": [
                    { "name": "daiAmount", "type": "uint256" },
                    { "name": "plsAmount", "type": "uint256" }
                ],
                "name": "deposit",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "withdraw",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [
                    { "name": "baseOrderSize", "type": "uint256" },
                    { "name": "safetyOrderSize", "type": "uint256" },
                    { "name": "priceDeviation", "type": "uint256" },
                    { "name": "maxSafetyOrders", "type": "uint256" },
                    { "name": "safetyOrderVolumeScale", "type": "uint256" },
                    { "name": "safetyOrderStepScale", "type": "uint256" }
                ],
                "name": "initializeDCA",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "executeDCA",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "constant": false,
                "inputs": [],
                "name": "stopDCA",
                "outputs": [],
                "payable": false,
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ];

        // Creating contract instance
        const dcaContract = new web3.eth.Contract(DCA_ABI, CONTRACT_ADDRESS);

        // Deposit function
        async function deposit() {
            try {
                const daiAmount = document.getElementById("daiAmount").value;
                const plsAmount = document.getElementById("plsAmount").value;

                if (!daiAmount || !plsAmount) {
                    alert("Please enter valid amounts for both DAI and PLS");
                    return;
                }

                await dcaContract.methods.deposit(daiAmount, plsAmount).send({ from: userAccount });
                alert('Deposit successful');
            } catch (error) {
                console.error('Deposit failed', error);
                alert('Transaction failed: ' + error.message);
            }
        }

        // Withdraw function
        async function withdraw() {
            try {
                await dcaContract.methods.withdraw().send({ from: userAccount });
                alert('Withdrawal successful');
            } catch (error) {
                console.error('Withdrawal failed', error);
                alert('Transaction failed: ' + error.message);
            }
        }

        // Initialize DCA function
        async function initializeDCA() {
            try {
                const baseOrderSize = document.getElementById("baseOrderSize").value;
                const safetyOrderSize = document.getElementById("safetyOrderSize").value;
                const priceDeviation = document.getElementById("priceDeviation").value;
                const maxSafetyOrders = document.getElementById("maxSafetyOrders").value;
                const safetyOrderVolumeScale = document.getElementById("safetyOrderVolumeScale").value;
                const safetyOrderStepScale = document.getElementById("safetyOrderStepScale").value;

                await dcaContract.methods.initializeDCA(
                    baseOrderSize,
                    safetyOrderSize,
                    priceDeviation,
                    maxSafetyOrders,
                    safetyOrderVolumeScale,
                    safetyOrderStepScale
                ).send({ from: userAccount });
                alert('DCA Initialized');
            } catch (error) {
                console.error('Failed to initialize DCA', error);
                alert('Transaction failed: ' + error.message);
            }
        }

        // Execute DCA function
        async function executeDCA() {
            try {
                await dcaContract.methods.executeDCA().send({ from: userAccount });
                alert('DCA Executed');
            } catch (error) {
                console.error('Failed to execute DCA', error);
                alert('Transaction failed: ' + error.message);
            }
        }

        // Stop DCA function
        async function stopDCA() {
            try {
                await dcaContract.methods.stopDCA().send({ from: userAccount });
                alert('DCA Stopped');
            } catch (error) {
                console.error('Failed to stop DCA', error);
                alert('Transaction failed: ' + error.message);
            }
        }
    </script>
</body>
</html>
