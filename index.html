<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DCA Contract Interaction</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .input-group {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>DCA Contract Interaction</h1>
    <p>Contract Address: <strong>0xFfD05ED8029FA81bAC4C1aF7Cf1B306bDcb99D85</strong></p>

    <div>
        <h2>Deposit Funds</h2>
        <div class="input-group">
            <label for="amount">Amount:</label>
            <input type="number" id="amount" step="0.01" placeholder="Enter deposit amount">
        </div>
        <button id="depositButton">Deposit</button>
    </div>

    <script>
        // Contract details
        const contractAddress = "0xFfD05ED8029FA81bAC4C1aF7Cf1B306bDcb99D85";
        const abi = [
            {
                "inputs": [
                    { "internalType": "uint256", "name": "amount", "type": "uint256" }
                ],
                "name": "deposit",
                "outputs": [],
                "stateMutability": "payable",
                "type": "function"
            }
        ];

        // Connect to MetaMask
        async function connectToMetaMask() {
            if (!window.ethereum) {
                alert("MetaMask is not installed!");
                return null;
            }

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []); // Request account access
            return provider.getSigner(); // Return the signer
        }

        // Deposit function
        document.getElementById("depositButton").addEventListener("click", async () => {
            const amount = document.getElementById("amount").value;

            if (!amount || amount <= 0) {
                alert("Please enter a valid deposit amount.");
                return;
            }

            try {
                const signer = await connectToMetaMask();
                if (!signer) return;

                const contract = new ethers.Contract(contractAddress, abi, signer);

                // Convert the deposit amount to wei (smallest unit of ETH)
                const transactionOptions = {
                    value: ethers.utils.parseEther(amount)
                };

                const tx = await contract.deposit(transactionOptions);
                alert("Transaction submitted! Waiting for confirmation...");

                await tx.wait();
                alert("Deposit successful!");
            } catch (error) {
                console.error("Error depositing:", error);
                alert("An error occurred. Check the console for details.");
            }
        });
    </script>
</body>
</html>
