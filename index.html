<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teddy Price Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h1>Teddy Price Tracker</h1>
  <div id="price">Fetching price...</div>
  
  <script>
    const CONTRACT_ADDRESS = "0xF055ee36f683Ed9d7749a20a06ceE0b4585f75e5";
    const RPC_URL = "https://rpc.pulsechain.com";
    const ABI = [
      {
        "inputs": [],
        "name": "getReserves",
        "outputs": [
          { "internalType": "uint112", "name": "reserve0", "type": "uint112" },
          { "internalType": "uint112", "name": "reserve1", "type": "uint112" },
          { "internalType": "uint32", "name": "blockTimestampLast", "type": "uint32" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "token0",
        "outputs": [
          { "internalType": "address", "name": "", "type": "address" }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "token1",
        "outputs": [
          { "internalType": "address", "name": "", "type": "address" }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    async function fetchPrice() {
      try {
        // Connect to PulseChain
        const provider = new ethers.providers.JsonRpcProvider(RPC_URL);

        // Create Contract Instance
        const contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, provider);

        // Fetch token addresses
        const token0 = await contract.token0();
        const token1 = await contract.token1();

        // Fetch reserves
        const { reserve0, reserve1 } = await contract.getReserves();

        // Determine which reserve corresponds to TEDDY and DAI
        const TEDDY_ADDRESS = "0xd6c31bA0754C4383A41c0e9DF042C62b5e918f6d";
        const DAI_ADDRESS = "0x6B175474E89094C44Da98b954EedeAC495271d0F";

        let teddyReserve, daiReserve;

        if (token0.toLowerCase() === TEDDY_ADDRESS.toLowerCase() && token1.toLowerCase() === DAI_ADDRESS.toLowerCase()) {
          teddyReserve = reserve0;
          daiReserve = reserve1;
        } else if (token0.toLowerCase() === DAI_ADDRESS.toLowerCase() && token1.toLowerCase() === TEDDY_ADDRESS.toLowerCase()) {
          teddyReserve = reserve1;
          daiReserve = reserve0;
        } else {
          throw new Error("Token addresses do not match TEDDY and DAI.");
        }

        // Calculate price: DAI per TEDDY
        const priceInDai = daiReserve / teddyReserve;

        // Display Price
        document.getElementById("price").innerText = `TEDDY/DAI Price: ${priceInDai.toFixed(6)}`;
      } catch (error) {
        console.error("Error fetching price:", error);
        document.getElementById("price").innerText = "Failed to fetch price.";
      }
    }

    // Fetch price on page load
    fetchPrice();
  </script>
</body>
</html>
